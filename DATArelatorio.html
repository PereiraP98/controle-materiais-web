<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Cabe√ßalho semelhante a detalhes.html -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes de Materiais (Relat√≥rios)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <!-- Inclus√£o do SDK do EmailJS atualizado (opcional) -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

    <style>
        .logo {
            width: 60px;
            height: auto;
        }

        /* √çcone no modo escuro */
        body.dark-mode #themeToggleButton img {
            filter: invert(1) brightness(1.2);
        }

        /* Link de m√™s/data */
        .arquivo-data {
            cursor: pointer;
            color: blue;
            text-decoration: underline;
            margin-left: 20px;
            display: inline-block;
            margin: 4px 0;
        }
        .arquivo-data:hover {
            color: darkblue;
        }

        /* Bot√£o de excluir todos, se quiser manter */
        .excluir-todos-button {
            background-color: #f44336;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        .excluir-todos-button:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body class="detalhes-page">
    <!-- Overlay (se precisar) -->
    <div id="overlay" class="overlay"></div>

    <header>
        <div class="header-container">
            <div class="logo-container">
                <img src="https://github.com/PereiraP98/controle-materiais-web/blob/main/assets/Logo2.png?raw=true" 
                     alt="DevCore Logo" class="logo">
            </div>
            <h1>Detalhes de Materiais (Relat√≥rios)</h1>
            <div class="header-buttons">
                <!-- Bot√£o de Voltar (se quiser redirecionar para detalhes.html) -->
                <button id="backToPanelButton" class="header-button" aria-label="Voltar ao Painel" title="Voltar ao Painel"
                        onclick="window.location.href='detalhes.html'">
                    <img src="https://github.com/PereiraP98/controle-materiais-web/blob/main/assets/painel.png?raw=true" 
                         alt="Painel" width="30" height="30">
                </button>
                <!-- Bot√£o de Logout -->
                <button id="logoutButton" class="header-button" aria-label="Logout" title="Sair">
                    <img src="https://github.com/PereiraP98/controle-materiais-web/blob/main/assets/logout.png?raw=true" 
                         alt="Logout" width="30" height="30">
                </button>
                <!-- Bot√£o de Alternar Tema -->
                <button id="themeToggleButton" class="header-button" aria-label="Alternar Tema" title="Alternar Tema">
                    <img src="https://github.com/PereiraP98/controle-materiais-web/blob/main/assets/temescuro.png?raw=true" 
                         alt="Tema Escuro" width="30" height="30">
                </button>
            </div>
        </div>
    </header>

    <main class="main-container">
        <!-- Aqui, acima das se√ß√µes, exibimos o "mes e arquivo" -->
        <section class="detalhes-container">
            <h2>Relat√≥rios Armazenados</h2>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                <div id="listaArquivos">
                    <!-- Aqui entram os meses e datas -->
                </div>
                <button id="excluirTodosButton" class="excluir-todos-button">Excluir Todos</button>
            </div>
        </section>

        <!-- Se√ß√£o de detalhes de materiais solicitados -->
        <section class="detalhes-container">
            <h2>Detalhes de Materiais Solicitados</h2>
            <div class="botoes-detalhes" style="display: flex; justify-content: space-between; margin-top: 10px;">
                <div>
                    <button type="button" id="excluirItensButton" class="excluir-button">Excluir Itens</button>
                    <button type="button" id="reportarItensButton" class="reportar-button">Reportar</button>
                </div>
                <div>
                    <!-- Aqui poderia ter um "Gerar PDF" ou algo assim, se quisesse -->
                </div>
            </div>

            <table id="detalhesTable">
                <thead>
                    <tr>
                        <!-- 0 -> hidden se quiser, mas aqui deixei no layout -->
                        <th class="checkbox-column hidden">
                            <input type="checkbox" id="selectAllCheckbox" title="Selecionar Todos">
                        </th>
                        <th>LOCAL</th>
                        <th>ITEM</th>
                        <th>QTD</th>
                        <th>DESTINO</th>
                        <th>DATA</th>
                        <th>HORA</th>
                        <th>RECEBER</th>
                        <th>TEMPO</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Preenchido ao clicar em um "arquivo" do m√™s/data -->
                </tbody>
            </table>
        </section>

        <!-- Se√ß√£o de detalhes de materiais recebidos -->
        <section class="detalhes-container">
            <div class="header-with-button">
                <h2>Detalhes de Materiais Recebidos</h2>
                <button type="button" id="excluirRecebidosButton" class="excluir-button">Excluir Itens</button>
            </div>
            <table id="recebidosTable">
                <thead>
                    <tr>
                        <!-- (0) hidden -->
                        <th class="checkbox-column hidden">
                            <input type="checkbox" id="selectAllRecebidosCheckbox" title="Selecionar Todos">
                        </th>
                        <!-- (1) LOCAL -->
                        <th>LOCAL</th>
                        <!-- (2) ITEM -->
                        <th>ITEM</th>
                        <!-- (3) QTD -->
                        <th>QTD</th>
                        <!-- (4) DESTINO -->
                        <th>DESTINO</th>
                        <!-- (5) DATA -->
                        <th>DATA</th>
                        <!-- (6) HORA -->
                        <th>HORA</th>
                        <!-- (7) RECEBIDO -->
                        <th>RECEBIDO</th>
                        <!-- (8) TEMPO -->
                        <th>TEMPO</th>
                        <!-- (9) GUARDADO -->
                        <th>GUARDADO</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Preenchido ao clicar em um "arquivo" do m√™s/data -->
                </tbody>
            </table>
        </section>
    </main>

    <footer>
        ¬© 2024 COLLAB - Todos os direitos reservados.
    </footer>

    <!-- Scripts b√°sicos -->
    <script src="script.js"></script>
    
    <!-- Se seu relatorio.js estiver aqui, carregue-o depois -->
    <script src="relatorio.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Carrega tema salvo
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }

        // Alternar tema
        const themeToggleButton = document.getElementById('themeToggleButton');
        themeToggleButton.addEventListener('click', function () {
            if (document.body.classList.contains('dark-mode')) {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            } else {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            }
        });

        // =======================
        // Carregar relatoriosMes
        // =======================
        const stored = localStorage.getItem('relatoriosMes');
        if (!stored) {
            document.getElementById('listaArquivos').innerHTML = 
              "<p>Nenhum relat√≥rio encontrado.</p>";
            return;
        }

        const relatoriosMes = JSON.parse(stored);

        // Montar HTML de pastas (meses) e arquivos (datas)
        let htmlArquivos = '';
        for (let mes in relatoriosMes) {
            htmlArquivos += `<h3>üìÅ ${mes}</h3>`;
            const datasObj = relatoriosMes[mes];
            for (let dataCurta in datasObj) {
                htmlArquivos += `
                  <div class="arquivo-data" data-mes="${mes}" data-data="${dataCurta}">
                    üìÑ ${dataCurta}
                  </div>
                `;
            }
        }
        document.getElementById('listaArquivos').innerHTML = htmlArquivos;

        // Ao clicar em um "arquivo-data", preenche as tabelas #detalhesTable e #recebidosTable
        const arquivosData = document.querySelectorAll('.arquivo-data');
        arquivosData.forEach(el => {
            el.addEventListener('click', () => {
                const mes = el.getAttribute('data-mes');
                const dataC = el.getAttribute('data-data');
                const { solicitados, recebidos } = relatoriosMes[mes][dataC];

                // 1) Preenche tabela #detalhesTable
                const corpoSolicitados = document.querySelector('#detalhesTable tbody');
                // Limpar antes de preencher
                corpoSolicitados.innerHTML = '';
                if (solicitados && solicitados.length > 0) {
                    solicitados.forEach(item => {
                        // Aqui voc√™ decide se coloca a checkbox hidden, mas vou manter
                        const row = `
                          <tr>
                            <td class="hidden"></td>
                            <td>${item.local}</td>
                            <td>${item.item}</td>
                            <td>${item.qtd}</td>
                            <td>${item.destino}</td>
                            <td>${item.data}</td>
                            <td>${item.hora}</td>
                            <td>--</td> <!-- Valor do col[7], se for "RECEBER" ignorado no relatorio -->
                            <td>${item.tempo}</td>
                          </tr>
                        `;
                        corpoSolicitados.insertAdjacentHTML('beforeend', row);
                    });
                }

                // 2) Preenche tabela #recebidosTable
                const corpoRecebidos = document.querySelector('#recebidosTable tbody');
                corpoRecebidos.innerHTML = '';
                if (recebidos && recebidos.length > 0) {
                    recebidos.forEach(item => {
                        const row = `
                          <tr>
                            <td class="hidden"></td>
                            <td>${item.local}</td>
                            <td>${item.item}</td>
                            <td>${item.qtd}</td>
                            <td>${item.destino}</td>
                            <td>${item.data}</td>
                            <td>${item.hora}</td>
                            <td>${item.recebido}</td>
                            <td>${item.tempo}</td>
                            <td>${item.guardado}</td>
                          </tr>
                        `;
                        corpoRecebidos.insertAdjacentHTML('beforeend', row);
                    });
                }
            });
        });

        // Bot√£o de excluir todos
        const excluirTodosButton = document.getElementById('excluirTodosButton');
        if (excluirTodosButton) {
            excluirTodosButton.addEventListener('click', () => {
                if (confirm('Deseja realmente excluir TODOS os relat√≥rios?')) {
                    localStorage.removeItem('relatoriosMes');
                    window.location.reload();
                }
            });
        }
    });
    </script>
</body>
</html>
