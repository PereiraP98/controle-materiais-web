<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Relatórios Armazenados</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="detalhes-page">
  <header>
    <div class="header-container">
      <div class="logo-container">
        <img src="..." alt="DevCore Logo" class="logo" />
      </div>
      <h1>Relatórios Armazenados</h1>
      <div class="header-buttons">
        <button onclick="window.location.href='detalhes.html'">
          <img src="..." alt="Voltar" width="30">
        </button>
        <button id="themeToggleButton">
          <img src="..." alt="Tema Escuro" width="30">
        </button>
      </div>
    </div>
  </header>

  <main class="main-container">
    <section class="detalhes-container">
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <h2>Relatórios Gerados</h2>
        <button id="excluirTodosButton" class="excluir-todos-button">
          Excluir Todos
        </button>
      </div>
      <div id="listaRelatorios" class="relatorio-container"></div>
    </section>
  </main>

  <footer>
    © 2024 COLLAB - Todos os direitos reservados.
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Tema escuro
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
      }

      const themeToggleButton = document.getElementById('themeToggleButton');
      themeToggleButton.addEventListener('click', function () {
        if (document.body.classList.contains('dark-mode')) {
          document.body.classList.remove('dark-mode');
          localStorage.setItem('theme', 'light');
        } else {
          document.body.classList.add('dark-mode');
          localStorage.setItem('theme', 'dark');
        }
      });

      // Carrega os relatórios
      const stored = localStorage.getItem('relatoriosMes');
      if (!stored) {
        document.getElementById('listaRelatorios').innerHTML = 
          '<p>Nenhum relatório encontrado.</p>';
        return;
      }

      const relatoriosMes = JSON.parse(stored);
      let html = '';

      for (let mes in relatoriosMes) {
        html += `<div class="relatorio-mes">
                   <h3>📁 ${mes}</h3>`;

        for (let dataCurta in relatoriosMes[mes]) {
          html += `
            <div class="relatorio-data" data-mes="${mes}" data-data="${dataCurta}">
              📄 ${dataCurta}
            </div>
            <div id="container-${mes}-${dataCurta}" style="display:none;"></div>
          `;
        }

        html += `</div>`;
      }
      document.getElementById('listaRelatorios').innerHTML = html;

      // Expande/colapsa
      const dataElements = document.querySelectorAll('.relatorio-data');
      dataElements.forEach(el => {
        el.addEventListener('click', () => {
          const mes = el.getAttribute('data-mes');
          const dataC = el.getAttribute('data-data');
          const containerDiv = document.getElementById(`container-${mes}-${dataC}`);
          if (!containerDiv) return;

          if (containerDiv.style.display === 'none' || containerDiv.style.display === '') {
            const items = relatoriosMes[mes][dataC].items;
            let tableHtml = `
              <table>
                <thead>
                  <tr>
                    <th>LOCAL</th>
                    <th>ITEM</th>
                    <th>QTD</th>
                    <th>DESTINO</th>
                    <th>DATA</th>
                    <th>HORA</th>
                    <th>REPORTADO</th>
                  </tr>
                </thead>
                <tbody>
            `;

            items.forEach(obj => {
              tableHtml += `
                <tr>
                  <td>${obj.local}</td>
                  <td>${obj.item}</td>
                  <td>${obj.qtd}</td>
                  <td>${obj.destino}</td>
                  <td>${obj.data}</td>
                  <td>${obj.hora}</td>
                  <td>${obj.reportado}</td>
                </tr>
              `;
            });

            tableHtml += '</tbody></table>';
            containerDiv.innerHTML = tableHtml;
            containerDiv.style.display = 'block';
          } else {
            containerDiv.style.display = 'none';
          }
        });
      });

      // Excluir todos
      const excluirTodosButton = document.getElementById('excluirTodosButton');
      excluirTodosButton.addEventListener('click', () => {
        if (confirm('Deseja excluir todos os relatórios?')) {
          localStorage.removeItem('relatoriosMes');
          window.location.reload();
        }
      });
    });
  </script>
</body>
</html>
