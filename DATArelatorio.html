<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Detalhes de Materiais (Relat√≥rios)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <!-- (Opcional) Inclus√£o do SDK do EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

    <style>
        .logo {
            width: 60px;
            height: auto;
        }
        body.dark-mode #themeToggleButton img {
            filter: invert(1) brightness(1.2);
        }

        /* Centraliza a √°rea de pastas/arquivos */
        .arquivo-container {
            text-align: center;
            margin: 20px 0;
        }

        .arquivo-data {
            cursor: pointer;
            color: blue;
            text-decoration: underline;
            margin: 4px 0;
            display: inline-block;
        }
        .arquivo-data:hover {
            color: darkblue;
        }

        /* Bot√£o de excluir todos (se quiser manter) */
        .excluir-todos-button {
            background-color: #f44336;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        .excluir-todos-button:hover {
            background-color: #d32f2f;
        }

        /* Deixa as duas se√ß√µes lado a lado */
        .main-container {
            display: flex;
            gap: 20px;
            justify-content: center; /* centraliza as se√ß√µes */
            padding: 20px;
        }

        /* Ajusta cada se√ß√£o para ter a mesma largura, se quiser */
        .detalhes-container {
            flex: 1;
            min-width: 400px; /* ou ajuste ao seu gosto */
        }
    </style>
</head>
<body class="detalhes-page">
    <div id="overlay" class="overlay"></div>

    <header>
        <div class="header-container">
            <div class="logo-container">
                <img src="https://github.com/PereiraP98/controle-materiais-web/blob/main/assets/Logo2.png?raw=true"
                     alt="DevCore Logo" class="logo">
            </div>
            <h1>Detalhes de Materiais (Relat√≥rios)</h1>
            <div class="header-buttons">
                <button onclick="window.location.href='detalhes.html'">
                    <img src="https://github.com/PereiraP98/controle-materiais-web/blob/main/assets/painel.png?raw=true"
                         alt="Painel" width="30" height="30">
                </button>
                <button id="logoutButton" class="header-button" aria-label="Logout" title="Sair">
                    <img src="https://github.com/PereiraP98/controle-materiais-web/blob/main/assets/logout.png?raw=true"
                         alt="Logout" width="30" height="30">
                </button>
                <button id="themeToggleButton" class="header-button" aria-label="Alternar Tema" title="Alternar Tema">
                    <img src="https://github.com/PereiraP98/controle-materiais-web/blob/main/assets/temescuro.png?raw=true"
                         alt="Tema Escuro" width="30" height="30">
                </button>
            </div>
        </div>
    </header>

    <!-- √Årea de pastas (meses) e arquivos (datas), centralizada -->
    <section class="arquivo-container">
        <h2>Relat√≥rios Armazenados</h2>
        <div id="listaArquivos" style="margin-bottom: 10px;">
            <!-- Aqui ser√£o listados os meses e arquivos -->
        </div>
        <!-- (Opcional) Bot√£o de excluir todos os relat√≥rios -->
        <button id="excluirTodosButton" class="excluir-todos-button">Excluir Todos</button>
    </section>

    <main class="main-container">
        <!-- Se√ß√£o de detalhes de materiais solicitados (lado esquerdo) -->
        <section class="detalhes-container">
            <h2>Detalhes de Materiais Solicitados</h2>
            <!-- Tabela com 9 colunas -->
            <table id="detalhesTable">
                <thead>
                    <tr>
                        <th class="checkbox-column hidden">
                            <input type="checkbox" id="selectAllCheckbox" title="Selecionar Todos">
                        </th>
                        <th>LOCAL</th>
                        <th>ITEM</th>
                        <th>QTD</th>
                        <th>DESTINO</th>
                        <th>DATA</th>
                        <th>HORA</th>
                        <th>RECEBER</th>
                        <th>TEMPO</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Preenchido dinamicamente ao clicar em um arquivo -->
                </tbody>
            </table>
        </section>

        <!-- Se√ß√£o de detalhes de materiais recebidos (lado direito) -->
        <section class="detalhes-container">
            <h2>Detalhes de Materiais Recebidos</h2>
            <!-- Tabela com 10 colunas -->
            <table id="recebidosTable">
                <thead>
                    <tr>
                        <th class="checkbox-column hidden">
                            <input type="checkbox" id="selectAllRecebidosCheckbox" title="Selecionar Todos">
                        </th>
                        <th>LOCAL</th>
                        <th>ITEM</th>
                        <th>QTD</th>
                        <th>DESTINO</th>
                        <th>DATA</th>
                        <th>HORA</th>
                        <th>RECEBIDO</th>
                        <th>TEMPO</th>
                        <th>GUARDADO</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Preenchido dinamicamente ao clicar em um arquivo -->
                </tbody>
            </table>
        </section>
    </main>

    <footer>
        ¬© 2024 COLLAB - Todos os direitos reservados.
    </footer>

    <script src="script.js"></script>
    <script src="relatorio.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Tema escuro
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }

        const themeToggleButton = document.getElementById('themeToggleButton');
        themeToggleButton.addEventListener('click', () => {
            if (document.body.classList.contains('dark-mode')) {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            } else {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            }
        });

        // Carrega relatoriosMes do localStorage
        const stored = localStorage.getItem('relatoriosMes');
        if (!stored) {
            document.getElementById('listaArquivos').innerHTML = 
              "<p>Nenhum relat√≥rio encontrado.</p>";
            return;
        }
        const relatoriosMes = JSON.parse(stored);

        // Montar a lista de pastas/meses e datas/arquivos
        let htmlArquivos = '';
        for (let mes in relatoriosMes) {
            htmlArquivos += `<h3>üìÅ ${mes}</h3>`;
            const datasObj = relatoriosMes[mes];
            for (let dataCurta in datasObj) {
                htmlArquivos += `
                  <div class="arquivo-data" data-mes="${mes}" data-data="${dataCurta}">
                    üìÑ ${dataCurta}
                  </div>
                `;
            }
        }
        document.getElementById('listaArquivos').innerHTML = htmlArquivos;

        // Ao clicar em um arquivo, preenche as duas tabelas
        const arquivosData = document.querySelectorAll('.arquivo-data');
        arquivosData.forEach(el => {
            el.addEventListener('click', () => {
                const mes = el.getAttribute('data-mes');
                const dataC = el.getAttribute('data-data');
                const { solicitados, recebidos } = relatoriosMes[mes][dataC];

                // 1) Limpa tabela de solicitados
                const corpoSol = document.querySelector('#detalhesTable tbody');
                corpoSol.innerHTML = '';
                if (solicitados && solicitados.length > 0) {
                    solicitados.forEach(item => {
                        const row = `
                          <tr>
                            <td class="hidden"></td>
                            <td>${item.local}</td>
                            <td>${item.item}</td>
                            <td>${item.qtd}</td>
                            <td>${item.destino}</td>
                            <td>${item.data}</td>
                            <td>${item.hora}</td>
                            <td>--</td>
                            <td>${item.tempo}</td>
                          </tr>
                        `;
                        corpoSol.insertAdjacentHTML('beforeend', row);
                    });
                }

                // 2) Limpa tabela de recebidos
                const corpoRec = document.querySelector('#recebidosTable tbody');
                corpoRec.innerHTML = '';
                if (recebidos && recebidos.length > 0) {
                    recebidos.forEach(item => {
                        const row = `
                          <tr>
                            <td class="hidden"></td>
                            <td>${item.local}</td>
                            <td>${item.item}</td>
                            <td>${item.qtd}</td>
                            <td>${item.destino}</td>
                            <td>${item.data}</td>
                            <td>${item.hora}</td>
                            <td>${item.recebido}</td>
                            <td>${item.tempo}</td>
                            <td>${item.guardado}</td>
                          </tr>
                        `;
                        corpoRec.insertAdjacentHTML('beforeend', row);
                    });
                }
            });
        });

        // Bot√£o de excluir todos os relat√≥rios
        const excluirTodosButton = document.getElementById('excluirTodosButton');
        if (excluirTodosButton) {
            excluirTodosButton.addEventListener('click', () => {
                if (confirm('Deseja realmente excluir TODOS os relat√≥rios?')) {
                    localStorage.removeItem('relatoriosMes');
                    window.location.reload();
                }
            });
        }
    });
    </script>
</body>
</html>
