<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes de Materiais</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Estilo para ocultar ou mostrar dinamicamente a coluna de seleção */
        .checkbox-column {
            width: 40px;
            text-align: center;
        }
        .checkbox-column.hidden {
            display: none;
        }
        .excluir-button {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 1em;
            position: absolute;
            top: 20px;
            right: 20px;
            transition: background-color 0.3s;
        }
        .excluir-button:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <img src="https://github.com/PereiraP98/controle-materiais-web/raw/refs/heads/main/assets/logo.webp" alt="DevCore Logo" class="logo">
            <h1>Detalhes de Materiais</h1>
        </div>
    </header>
    <main>
        <section class="detalhes-container">
            <h2>Detalhes de Materiais Solicitados</h2>
            <!-- Botão Excluir Itens -->
            <button type="button" id="excluirItensButton" class="excluir-button">Excluir Itens</button>
            <table id="detalhesTable">
                <thead>
                    <tr>
                        <th class="checkbox-column hidden">Selecionar</th>
                        <th>LOCAL</th>
                        <th>ITEM</th>
                        <th>QTD</th>
                        <th>DESTINO</th>
                        <th>DATA</th>
                        <th>HORA</th>
                        <th>RECEBER</th>
                        <th style="color: yellow;">REPORT</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Os registros de materiais solicitados serão adicionados aqui -->
                </tbody>
            </table>

            <!-- Botões de navegação -->
            <div class="button-container">
                <button type="button" onclick="location.href='index.html'">Voltar</button>
                <button type="button" id="materiaisRecebidosButton">Materiais Recebidos</button>
            </div>
        </section>
    </main>

    <!-- Janela de Confirmação -->
    <div class="janela-flutuante" id="janelaConfirmacao" style="display: none;">
        <h2>Confirmação</h2>
        <p>Tem certeza que deseja excluir os itens selecionados?</p>
        <button id="confirmarButton">SIM</button>
        <button id="cancelarButton">NÃO</button>
    </div>

    <footer>
        © 2024 Controle de Materiais - Todos os direitos reservados.
    </footer>

    <script>
        const excluirItensButton = document.getElementById("excluirItensButton");
        const confirmarButton = document.getElementById("confirmarButton");
        const cancelarButton = document.getElementById("cancelarButton");
        const janelaConfirmacao = document.getElementById("janelaConfirmacao");
        const detalhesTable = document.getElementById("detalhesTable");
        let selecionandoItens = false;

        // Ocultar/Mostrar coluna de seleção
        function toggleSelectionColumn(show) {
            const columnIndex = 0; // Index da coluna de checkboxes
            const headerCell = detalhesTable.querySelector("thead th:nth-child(1)");
            const rows = detalhesTable.querySelectorAll("tbody tr");
            
            headerCell.classList.toggle("hidden", !show);
            rows.forEach((row) => {
                const cell = row.children[columnIndex];
                if (cell) {
                    cell.style.display = show ? "table-cell" : "none";
                }
            });
        }

        // Carregar dados armazenados
        document.addEventListener("DOMContentLoaded", function () {
            const detalhes = JSON.parse(localStorage.getItem("detalhes")) || [];

            detalhes.forEach((detalhe) => {
                const newRow = document.createElement("tr");
                newRow.innerHTML = `
                    <td class="checkbox-column hidden"><input type="checkbox" class="item-checkbox"></td>
                    <td>${detalhe.local}</td>
                    <td>${detalhe.item}</td>
                    <td>${detalhe.quantidade}</td>
                    <td>${detalhe.destino}</td>
                    <td>${detalhe.dataAtual}</td>
                    <td>${detalhe.horario}</td>
                    <td><button class="receberButton">Receber</button></td>
                    <td style="color: yellow; text-align: center;">REPORT</td>
                `;
                detalhesTable.querySelector("tbody").appendChild(newRow);
            });

            toggleSelectionColumn(false); // Ocultar coluna de seleção inicialmente
        });

        // Alternar modo de seleção
        excluirItensButton.addEventListener("click", () => {
            selecionandoItens = !selecionandoItens;
            toggleSelectionColumn(selecionandoItens);

            if (selecionandoItens) {
                excluirItensButton.textContent = "Confirmar Exclusão";
            } else {
                janelaConfirmacao.style.display = "block";
            }
        });

        // Confirmar exclusão de itens
        confirmarButton.addEventListener("click", () => {
            const checkboxes = document.querySelectorAll(".item-checkbox:checked");
            checkboxes.forEach((checkbox) => {
                const row = checkbox.closest("tr");
                detalhesTable.querySelector("tbody").removeChild(row);
            });

            const linhasAtualizadas = Array.from(detalhesTable.querySelectorAll("tbody tr")).map((row) => ({
                local: row.cells[1].innerText,
                item: row.cells[2].innerText,
                quantidade: row.cells[3].innerText,
                destino: row.cells[4].innerText,
                dataAtual: row.cells[5].innerText,
                horario: row.cells[6].innerText,
            }));

            localStorage.setItem("detalhes", JSON.stringify(linhasAtualizadas));

            janelaConfirmacao.style.display = "none";
            toggleSelectionColumn(false);
            selecionandoItens = false;
            excluirItensButton.textContent = "Excluir Itens";
            alert("Itens excluídos com sucesso!");
        });

        // Cancelar exclusão de itens
        cancelarButton.addEventListener("click", () => {
            janelaConfirmacao.style.display = "none";
            toggleSelectionColumn(false);
            selecionandoItens = false;
            excluirItensButton.textContent = "Excluir Itens";
        });
    </script>
</body>
</html>
